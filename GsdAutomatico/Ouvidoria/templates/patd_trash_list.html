{% extends "base.html" %}
{% load static %}

{% block title %}Lixeira de PATDs{% endblock %}

{% block content %}
<style>
    /* Ajustes específicos para a tabela da lixeira */
    .trash-actions {
        display: flex;
        gap: 8px;
        align-items: center;
        flex-wrap: wrap;
    }
    .badge-excluida {
        background-color: var(--danger-color, #dc3545);
        color: white;
        padding: 3px 6px;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: bold;
        margin-left: 5px;
    }
    .text-muted-theme {
        color: var(--text-secondary);
        font-style: italic;
    }

    /* ESTILIZAÇÃO PREMIUM DO CONTADOR DE EXCLUSÃO */
    .countdown-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        white-space: nowrap;
        letter-spacing: 0.3px;
    }
    .countdown-safe {
        background-color: rgba(108, 117, 125, 0.15);
        color: var(--text-secondary, #adb5bd);
        border: 1px solid rgba(108, 117, 125, 0.3);
    }
    .countdown-warning {
        background-color: rgba(255, 193, 7, 0.15);
        color: #ffc107;
        border: 1px solid rgba(255, 193, 7, 0.3);
    }
    .countdown-danger {
        background-color: rgba(220, 53, 69, 0.15);
        color: #ff6b6b;
        border: 1px solid rgba(220, 53, 69, 0.4);
    }
</style>

<div class="table-header">
    <h1>Lixeira de PATDs</h1>
    <div class="actions">
        <a href="{% url 'Ouvidoria:patd_list' %}" class="btn btn-secondary">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="16" height="16">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3" />
            </svg>
            Voltar para PATDs
        </a>
    </div>
</div>

<div class="table-responsive">
    <table class="data-table">
        <thead>
            <tr>
                <th>Nº PATD (Antigo)</th>
                <th>Nº Atual</th>
                <th>Militar Acusado</th>
                <th>Data de Exclusão</th>
                <th>Exclusão Automática</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for patd in patds %}
            <tr>
                <td>
                    <strong>{{ patd.numero_patd_anterior|default:"-" }}</strong>
                    <span class="badge-excluida">Lixeira</span>
                </td>
                <td>
                    {% if patd.numero_patd %}
                        {{ patd.numero_patd }}
                    {% else %}
                        <span class="text-muted-theme">Sem número</span>
                    {% endif %}
                </td>
                <td>{{ patd.militar.nome_guerra }}</td>
                <td>{{ patd.deleted_at|date:"d/m/Y H:i" }}</td>
                
                <td>
                    {% if patd.dias_para_exclusao != None %}
                        {% if patd.dias_para_exclusao > 5 %}
                            <span class="countdown-badge countdown-safe" title="Será excluída permanentemente em {{ patd.dias_para_exclusao }} dias">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                                em {{ patd.dias_para_exclusao }} dias
                            </span>
                        {% elif patd.dias_para_exclusao > 1 %}
                            <span class="countdown-badge countdown-warning" title="Atenção: Exclusão em {{ patd.dias_para_exclusao }} dias">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                                em {{ patd.dias_para_exclusao }} dias
                            </span>
                        {% elif patd.dias_para_exclusao == 1 %}
                            <span class="countdown-badge countdown-danger">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                                Amanhã
                            </span>
                        {% else %}
                            <span class="countdown-badge countdown-danger">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                                Hoje
                            </span>
                        {% endif %}
                    {% else %}
                        -
                    {% endif %}
                </td>
                
                <td class="trash-actions">
                    <a href="{% url 'Ouvidoria:patd_detail' patd.pk %}" class="btn btn-sm btn-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="14" height="14" style="margin-right: 4px;">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                        Detalhes
                    </a>

                    <form action="{% url 'Ouvidoria:patd_restore' patd.pk %}" method="post" style="margin: 0;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-sm btn-success">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="14" height="14" style="margin-right: 4px;">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
                            </svg>
                            Restaurar
                        </button>
                    </form>

                    <form action="{% url 'Ouvidoria:patd_permanently_delete' patd.pk %}" method="post" class="delete-permanent-form" style="margin: 0;">
                        {% csrf_token %}
                        <button type="button" class="btn btn-sm btn-danger btn-delete-permanent">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="14" height="14" style="margin-right: 4px;">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                            </svg>
                            Excluir
                        </button>
                    </form>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 48px; height: 48px; margin-bottom: 10px; opacity: 0.5;">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                    </svg>
                    <br>
                    A lixeira está vazia.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if is_paginated %}
<div class="pagination">
    <span class="step-links">
        {% if page_obj.has_previous %}
            <a href="?page=1">&laquo; primeira</a>
            <a href="?page={{ page_obj.previous_page_number }}">anterior</a>
        {% endif %}
        <span class="current">
            Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}.
        </span>
        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}">próxima</a>
            <a href="?page={{ page_obj.paginator.num_pages }}">última &raquo;</a>
        {% endif %}
    </span>
</div>
{% endif %}

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const deleteButtons = document.querySelectorAll('.btn-delete-permanent');
    
    deleteButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            if (confirm('ATENÇÃO: Tem certeza que deseja excluir esta PATD permanentemente? Esta ação não pode ser desfeita.')) {
                this.closest('.delete-permanent-form').submit();
            }
        });
    });
});
</script>
{% endblock %}