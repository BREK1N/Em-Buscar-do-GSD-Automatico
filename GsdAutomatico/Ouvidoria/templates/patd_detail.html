{% extends 'base.html' %}

{% block title %}Detalhes da PATD Nº {{ patd.numero_patd }}{% endblock %}

{% block content %}
<h1>PATD Nº {{ patd.numero_patd }}</h1>

<div class="detail-grid">
    <div class="detail-item">
        <strong>Militar Acusado:</strong>
        <p><a href="{% url 'Ouvidoria:militar_patd_list' patd.militar.pk %}">{{ patd.militar }}</a></p>
    </div>
    <div class="detail-item">
        <strong>Oficial Responsável:</strong>
        <p>{{ patd.oficial_responsavel|default:"Não atribuído" }}</p>
    </div>
    <div class="detail-item">
        <strong>Data de Início:</strong>
        <p>{{ patd.data_inicio|date:"d/m/Y H:i" }}</p>
    </div>
    <div class="detail-item">
        <strong>Data de Término:</strong>
        <p>{{ patd.data_termino|date:"d/m/Y H:i"|default:"Em andamento" }}</p>
    </div>
    <div class="detail-item-full">
        <strong>Descrição da Transgressão:</strong>
        <p>{{ patd.transgressao|linebreaks }}</p>
    </div>
</div>

<div class="form-actions">
    <a href="{% url 'Ouvidoria:patd_update' patd.pk %}" class="btn btn-primary">Editar PATD</a>
    <a href="{% url 'Ouvidoria:patd_list' %}" class="btn btn-secondary">Voltar para a Lista</a>
    <!-- O estilo 'margin-left: auto' foi movido para o CSS principal -->
    <button type="button" class="btn btn-delete" id="delete-patd-btn">Excluir</button>
</div>

<!-- Modal de Confirmação de Exclusão -->
<div class="modal-overlay" id="delete-modal">
    <div class="modal-content">
        <h3>Confirmar Exclusão</h3>
        <p>Tem a certeza de que deseja excluir a PATD Nº {{ patd.numero_patd }}? Esta ação não pode ser desfeita.</p>
        <form method="post" action="{% url 'Ouvidoria:patd_delete' patd.pk %}" style="display: inline;">
            {% csrf_token %}
            <div class="form-actions" style="justify-content: flex-end;">
                <button type="button" class="btn btn-secondary" id="cancel-delete-btn">Cancelar</button>
                <button type="submit" class="btn btn-delete">Sim, Excluir</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const deleteModal = document.getElementById('delete-modal');
    const deleteBtn = document.getElementById('delete-patd-btn');
    const cancelBtn = document.getElementById('cancel-delete-btn');

    if (deleteBtn && deleteModal && cancelBtn) {
        deleteBtn.addEventListener('click', () => {
            deleteModal.classList.add('active');
        });

        cancelBtn.addEventListener('click', () => {
            deleteModal.classList.remove('active');
        });

        // Fecha o modal se clicar fora do conteúdo
        deleteModal.addEventListener('click', function(event) {
            if (event.target === this) {
                this.classList.remove('active');
            }
        });
    }
});
</script>
{% endblock %}
